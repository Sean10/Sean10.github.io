---
title: 豆瓣爬虫细节
date: 2018-03-09 20:54:27
updated:
tags: [爬虫, Python, Spider]
categories: [专业]
---

```
https://movie.douban.com/j/new_search_subjects?sort=T&range=0,10&tags=%E5%89%A7%E6%83%85&start=10
```

像这种json获取的链接，倒是没有cookie的要求，即便多线程爬取几百页也没有被ban.

-------

之前直接使用了rq任务队列，导致不知道该怎么写多线程了。

暂时先重新用自带的queu写写看多线程。

目前20个线程爬取10页约200个评论，耗时8.98秒,不过这里固定一个ip测试立马就被ban了。

只是添加了bid的cookie 和 随机UA似乎并不足够.

明明使用了可用的代理，但是被ban的却还有我的真实ip，好奇怪。对ip测试网站测试了下，检测的ip是没有问题的，的确是代理后的ip.

怀疑是发送的包中包含了我本机的信息。

姑且在requests的选项中使用了verify=False，暂时可以抓取一部分了。


---------

在用charles测试抓包的过程中遭遇了SSLError(SSLError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed (_ssl.c:777)'),))问题,似乎与python requests对charles ssl认证有关。

从charles保存根证书导入python requests即可。



# 参考资料
1. (requests charles SSL)[https://www.charlesproxy.com/documentation/using-charles/ssl-certificates/]
