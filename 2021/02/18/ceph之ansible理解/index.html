<!DOCTYPE html>
<html>
<head>
    

    

    



    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
    
    
    
    
    <title>ceph之ansible理解 | 行路中. | 脚踏实地</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="ceph,linux,ansible">
    <meta name="description" content="理解 大家最受影响的就是一半时间开发, 一半时间运维的这个问题. 利用一个成熟的配置文件, 快速部署起自己需要的环境, 而不是一步步通过页面控制点击, 这是一个很省力的事情. 将运维中与部署相关的事情通过一些成熟的模板化的配置文件来提供, 最好不过了. ansible比较大的几个优点  由于是开源框架, 基于ansible的针对其他开源软件的配套代价较多  比如集成钉钉等  配置文件化管理部署成熟">
<meta name="keywords" content="ceph,linux,ansible">
<meta property="og:type" content="article">
<meta property="og:title" content="ceph之ansible理解">
<meta property="og:url" content="https://sean10.github.io/2021/02/18/ceph之ansible理解/index.html">
<meta property="og:site_name" content="行路中.">
<meta property="og:description" content="理解 大家最受影响的就是一半时间开发, 一半时间运维的这个问题. 利用一个成熟的配置文件, 快速部署起自己需要的环境, 而不是一步步通过页面控制点击, 这是一个很省力的事情. 将运维中与部署相关的事情通过一些成熟的模板化的配置文件来提供, 最好不过了. ansible比较大的几个优点  由于是开源框架, 基于ansible的针对其他开源软件的配套代价较多  比如集成钉钉等  配置文件化管理部署成熟">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://sean10.github.io/2021/02/18/ceph之ansible理解/ceph之ansible理解_2020-11-12-00-49-50.png">
<meta property="og:updated_time" content="2021-02-18T11:15:29.900Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ceph之ansible理解">
<meta name="twitter:description" content="理解 大家最受影响的就是一半时间开发, 一半时间运维的这个问题. 利用一个成熟的配置文件, 快速部署起自己需要的环境, 而不是一步步通过页面控制点击, 这是一个很省力的事情. 将运维中与部署相关的事情通过一些成熟的模板化的配置文件来提供, 最好不过了. ansible比较大的几个优点  由于是开源框架, 基于ansible的针对其他开源软件的配套代价较多  比如集成钉钉等  配置文件化管理部署成熟">
<meta name="twitter:image" content="https://sean10.github.io/2021/02/18/ceph之ansible理解/ceph之ansible理解_2020-11-12-00-49-50.png">
    
        <link rel="alternate" type="application/atom+xml" title="行路中." href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.png">
    <link rel="stylesheet" href="/css/style.css?v=1.7.2">
    <script>window.lazyScripts=[]</script>

    <!-- custom head --><!-- hexo-inject:begin --><!-- hexo-inject:end -->
    

</head>

<body>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Sean10</h5>
          <a href="mailto:sean10reborn@gmail.com" title="sean10reborn@gmail.com" class="mail">sean10reborn@gmail.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/sean10" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">ceph之ansible理解</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">ceph之ansible理解</h1>
        <h5 class="subtitle">
            
                <time datetime="2021-02-18T11:36:07.000Z" itemprop="datePublished" class="page-time">
  2021-02-18
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/pro/">专业</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#理解"><span class="post-toc-number">1.</span> <span class="post-toc-text">理解</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#ansible比较大的几个优点"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">ansible比较大的几个优点</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#不建议的操作"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">不建议的操作</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#tidb开发计划"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">tidb开发计划</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#并行任务引擎"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">并行任务引擎</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#同类比较"><span class="post-toc-number">2.</span> <span class="post-toc-text">同类比较</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#最佳实践"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">最佳实践</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#重试逻辑---start-at-task"><span class="post-toc-number">2.1.1.</span> <span class="post-toc-text">重试逻辑 --start-at-task</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#插件开发"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">插件开发</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#callback"><span class="post-toc-number">2.2.1.</span> <span class="post-toc-text">callback</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#rolling-upgrade什么意思"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">rolling upgrade什么意思</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#继承的方法"><span class="post-toc-number">2.3.0.1.</span> <span class="post-toc-text">继承的方法</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#理解开发方式"><span class="post-toc-number">2.4.</span> <span class="post-toc-text">理解开发方式</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#python调用ansible"><span class="post-toc-number">2.4.1.</span> <span class="post-toc-text">python调用ansible</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#ansible使用"><span class="post-toc-number">3.</span> <span class="post-toc-text">ansible使用</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#调试方式"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">调试方式</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#tower付费部分"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">tower付费部分</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#练习方式"><span class="post-toc-number">3.3.</span> <span class="post-toc-text">练习方式</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#执行"><span class="post-toc-number">3.4.</span> <span class="post-toc-text">执行</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#语法"><span class="post-toc-number">3.5.</span> <span class="post-toc-text">语法</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#playbook"><span class="post-toc-number">3.5.1.</span> <span class="post-toc-text">playbook</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#delegate_to"><span class="post-toc-number">3.5.2.</span> <span class="post-toc-text">delegate_to</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#role"><span class="post-toc-number">3.5.3.</span> <span class="post-toc-text">role</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#依赖管理"><span class="post-toc-number">3.5.3.1.</span> <span class="post-toc-text">依赖管理</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ad-hoc"><span class="post-toc-number">3.5.4.</span> <span class="post-toc-text">ad-hoc</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#ceph-ansile"><span class="post-toc-number">4.</span> <span class="post-toc-text">ceph-ansile</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#问题"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">问题</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#二次开发问题"><span class="post-toc-number">4.1.1.</span> <span class="post-toc-text">二次开发问题</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#实践中的一些疑问"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">实践中的一些疑问</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#command和-debug冲突"><span class="post-toc-number">4.2.1.</span> <span class="post-toc-text">command和 debug冲突?</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#shell和command有没有区别"><span class="post-toc-number">4.2.2.</span> <span class="post-toc-text">shell和command有没有区别?</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#changed-是用来标记task的幂等性满足与否"><span class="post-toc-number">4.2.3.</span> <span class="post-toc-text">changed 是用来标记task的幂等性满足与否?</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#groups保留字"><span class="post-toc-number">4.2.4.</span> <span class="post-toc-text">groups保留字</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#变量和inventory还是有点区别的-虽然是这个主机组的-但是单纯的变量其实没有主机组的概念的."><span class="post-toc-number">4.2.5.</span> <span class="post-toc-text">变量和inventory还是有点区别的, 虽然是这个主机组的, 但是单纯的变量其实没有主机组的概念的.</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#为什么ceph没有提供给ansible基于rados的接口呢"><span class="post-toc-number">4.2.6.</span> <span class="post-toc-text">为什么ceph没有提供给ansible基于rados的接口呢?</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#you-cannot-register-a-variable-but-you-can-set-a-fact-which-in-most-use-cases-including-yours-will-be-equivalent-to-a-variable"><span class="post-toc-number">4.2.7.</span> <span class="post-toc-text">You cannot register a variable, but you can set a fact (which in most use cases, including yours, will be equivalent to a variable):</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#要使用json_query-需要安装jmespath"><span class="post-toc-number">4.2.8.</span> <span class="post-toc-text">要使用json_query , 需要安装jmespath</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ansible使用register就会被标记成changed"><span class="post-toc-number">4.2.9.</span> <span class="post-toc-text">ansible使用register就会被标记成changed?</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#为什么我用filter-带上2个大括号就无法识别出对象了呢"><span class="post-toc-number">4.2.10.</span> <span class="post-toc-text">为什么我用filter, 带上2个大括号就无法识别出对象了呢?</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#对于您的模块支持检查模式您必须在实例化ansiblemodule对象时传递supports_check_mode-true-当启用检查模式时ansiblemodule.check_mode属性将计算为true"><span class="post-toc-number">4.2.11.</span> <span class="post-toc-text">对于您的模块支持检查模式，您必须在实例化AnsibleModule对象时传递supports_check_mode = True。 当启用检查模式时，AnsibleModule.check_mode属性将计算为True。</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ansible的library不允许使用print-居然就会报错.-没有日志-需要之后再找怎么记录日志的方式"><span class="post-toc-number">4.2.12.</span> <span class="post-toc-text">ansible的library不允许使用print, 居然就会报错. 没有日志, 需要之后再找怎么记录日志的方式</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#out不能是变量-只能是字符串"><span class="post-toc-number">4.2.13.</span> <span class="post-toc-text">out不能是变量? 只能是字符串?</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#通过debug可以打印出ansible_facts-但是直接引用就一直打印不出来-忽然脑子过了一下-想通了-ansible_facts应该是上层概念-对于使用的应该直接填key就可以了-然后的确拿出来了."><span class="post-toc-number">4.2.14.</span> <span class="post-toc-text">通过debug可以打印出Ansible_facts, 但是直接引用就一直打印不出来, 忽然脑子过了一下, 想通了, ansible_facts应该是上层概念, 对于使用的应该直接填key就可以了, 然后的确拿出来了.</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#字符串输出转换-坑"><span class="post-toc-number">4.2.15.</span> <span class="post-toc-text">字符串输出转换, 坑</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ansiblesequence是什么东西"><span class="post-toc-number">4.2.16.</span> <span class="post-toc-text">ansibleSequence是什么东西?</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#字典的key索引不会被jinja2解析-这个真的是深坑"><span class="post-toc-number">4.2.17.</span> <span class="post-toc-text">字典的key索引不会被Jinja2解析, 这个真的是深坑</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#莫名其妙的module-failure"><span class="post-toc-number">4.2.18.</span> <span class="post-toc-text">莫名其妙的module failure</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#python3支持问题"><span class="post-toc-number">4.2.19.</span> <span class="post-toc-text">python3支持问题</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#group_vars的读取时间是什么时候嗯"><span class="post-toc-number">4.2.20.</span> <span class="post-toc-text">group_vars的读取时间是什么时候嗯</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#怎么将当前读入的配置及收集到的facts配置导出呢"><span class="post-toc-number">4.2.21.</span> <span class="post-toc-text">怎么将当前读入的配置及收集到的facts配置导出呢</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#另外-其实我并不需要ansible原生的gather_facts-因为他能够给出来的ip-现在我知道一些python的原生库获取-重点在于-我怎么把多个节点的数据给聚合到一个节点上."><span class="post-toc-number">4.2.22.</span> <span class="post-toc-text">另外, 其实我并不需要ansible原生的gather_facts, 因为他能够给出来的ip, 现在我知道一些python的原生库获取, 重点在于, 我怎么把多个节点的数据给聚合到一个节点上.</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#vars选项的运行时间是什么时候呢-如果我采用task-他能在我指定task前自动运行吗"><span class="post-toc-number">4.2.23.</span> <span class="post-toc-text">vars选项的运行时间是什么时候呢? 如果我采用task, 他能在我指定task前自动运行吗?</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#reference"><span class="post-toc-number">5.</span> <span class="post-toc-text">Reference</span></a></li></ol>
        </nav>
    </aside>


<article id="post-ceph之ansible理解"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">ceph之ansible理解</h1>
        <div class="post-meta">
            <time class="post-time" title="2021-02-18 19:36:07" datetime="2021-02-18T11:36:07.000Z"  itemprop="datePublished">2021-02-18</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/pro/">专业</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h1 id="理解">理解</h1>
<p>大家最受影响的就是一半时间开发, 一半时间运维的这个问题. 利用一个成熟的配置文件, 快速部署起自己需要的环境, 而不是一步步通过页面控制点击, 这是一个很省力的事情. 将运维中与部署相关的事情通过一些成熟的模板化的配置文件来提供, 最好不过了.</p>
<h2 id="ansible比较大的几个优点">ansible比较大的几个优点</h2>
<ul>
<li>由于是开源框架, 基于ansible的针对其他开源软件的配套代价较多
<ul>
<li>比如集成钉钉等</li>
</ul></li>
<li>配置文件化管理部署成熟
<ul>
<li>可针对不同的环境, 使用不同的配置文件快速部署</li>
<li>可以使用开源插件快捷对接配置管理服务
<ul>
<li>因为 Ansible2.0以上的版本已经原生集成了consule: consul_module</li>
</ul></li>
</ul></li>
</ul>
<h2 id="不建议的操作">不建议的操作</h2>
<p>建议遵循<code>unix</code>思想, 一个工具只做该做的事情, ansible虽然提供了能力, 但是能由脚本来完成的事情, 没必要在ansible中进行处理 根据[^10]终于意识到我现在所处理的最别扭的地方在哪里了…这篇文章中说了下述几点.</p>
<ul>
<li>在 ansible 中使用复杂的语法规则
<ul>
<li>更推荐直接封装成脚本, 由脚本来进行这些操作.但是脚本的粒度拆分, 什么应该让ansible来操作, 什么应该让脚本来处理, 是个边界.</li>
</ul></li>
<li>明明几行 Shell 就可以搞定的事情，为什么一定要使用 Ansible 来做呢？
<ul>
<li>明明一个 Shell 脚本就可以完成的环境监察，为什么一定要使用 Ansible Playbook 来做呢？要知道 Playbook 编写语法虽然是 YAML，但是使用起来并不简单，有很多特殊的语法需要去注意，完全没有必要花费精力去学习一个新的工具去完成。 &gt; * 如果脚本中存在较多判断，不宜使用 Playbook 实现逻辑 &gt; * 如果脚本中存在部分参数解析功能，不宜使用 Playbook 实现逻辑 &gt; * 不要过度拆分 task，保证每个 task 完整性</li>
</ul></li>
</ul>
<blockquote>
<p>从个人使用上来说，Ansible 还是很好用的，至少它无需 Agent，SSH 连接等特性，使用起来很友好。 但是我们也不应该过分使用 Playbook，编写 Playbook 解析 json 花费了不少的时间，远不如直接在被执行脚本中完成的成本低。</p>
</blockquote>
<h2 id="tidb开发计划">tidb开发计划</h2>
<blockquote>
<p>deploy.yml 用来部署集群。执行 deploy 操作会自动将配置文件、binary 等分发到对应的节点上；如果是已经存在的集群，执行时会对比配置文件、binary 等信息，如果有变更就会覆盖原来的文件并且将原来的文件备份到 backup（默认） 目录。 start.yml 用来启动集群。注意：这个操作只是 start 集群，不会对配置等信息做任何更改 stop.yml 用来停止集群。与 start 一样，不会对配置等做任何修改。 rolling_update.yml 用来逐个更新集群内的节点。此操作会按 PD、TiKV、TiDB 的顺序以 1 并发对集群内的节点逐个做 stop → deploy → start 操作，其中对 PD 和 TiKV 操作时会先迁移掉 leader，将对集群的影响降到最低。一般用来对集群做配置更新或者升级。 rolling_update_monitor.yml 用来逐个更新监控组件，与 rolling_update.yml 功能一样，面向的组件有区别。 unsafe_cleanup.yml 用来清掉整个集群。这个操作会先将整个集群停掉服务，然后删除掉相关的目录，操作不可逆，需要谨慎。 unsafe_cleanup_data.yml 用来清理掉 PD、TiKV、TiDB 的数据。执行时会先将对应服务停止，然后再清理数据，操作不可逆，需要谨慎。这个操作不涉及监控。</p>
</blockquote>
<h2 id="并行任务引擎">并行任务引擎</h2>
<blockquote>
<p>作业编排：可以自由选择相应的原子化操作，编排和发布新的作业流程 可视化: 通过拖拽鼠标编排作业流程和参数表单，作业运行与任务的状态可视化 并行调度: 同一个作业中的任务支持并行执行，在很多场景下能极大的缩短执行时间 实时监控: 任务的运行状态在页面上实时更新 断点执行: 执行错误的任务在修复错误后可以继续执行，不需要重新执行整个作业 任务回滚: 遇到错误，可以支持回滚作业中已经执行过的任务，恢复执行环境 作业模板: 可定制作业模板，用模板创建作业实例，避免重复工作 任务组: 在作业模板中把任务分组，在创建任务实例时候可以动态的复制任务组，相似的作业使用同样的模板，但又不限制于模板 计算表达式: 使用表达式动态的计算任务的参数值，能够极大的简化重复参数的输入以及复杂参数的拼接 动态参数：前面任务的输出作为后续任务的输入参数</p>
</blockquote>
<h1 id="同类比较">同类比较</h1>
<ul>
<li>fabric
<ul>
<li>快速入门使用</li>
</ul></li>
<li>puppet
<ul>
<li>C/S架构</li>
<li>大部分付费功能</li>
</ul></li>
<li>Chef</li>
<li>ansible
<ul>
<li>语义多层架构</li>
<li>基于ssh, push/pull均支持</li>
<li>cephadm是使用工具的配置语法进行部署后, 为了更强程度的自定义而进阶开发的产物.</li>
</ul></li>
<li>SaltStack
<ul>
<li>基于python的开源CM工具</li>
<li>CS架构</li>
<li>学习曲线低</li>
<li>cephadm之后有配套saltstack的
<ul>
<li><a href="https://github.com/ceph/ceph-salt" target="_blank" rel="noopener">ceph/ceph-salt: Deploy Ceph clusters using cephadm</a></li>
</ul></li>
</ul></li>
<li>Kolla-ansible?
<ul>
<li>应该是openstack用的</li>
<li>苏宁的产品化Hull思路
<ul>
<li>基于上面的, 设计标准的RESTAPI</li>
<li>定义Workflow</li>
<li>可视化安装</li>
<li>增加Data Center, cluster, region等逻辑概念, 更好的满足用户的部署需求.</li>
</ul></li>
</ul></li>
</ul>
<h2 id="最佳实践">最佳实践</h2>
<h3 id="重试逻辑---start-at-task">重试逻辑 <code>--start-at-task</code></h3>
<p>这里采用的方案是自定义一个<code>callback</code>的插件, 将<code>failed</code>的<code>task</code>记录下来,见<a href="#callback">callback</a>, 然后封装一个<code>CLI</code>, 在下次执行的时候增加<code>--start-at-task {task_name}</code>来进行调度. ### 优化方案 和一开始调研时的目的有点不一样, 现在发现的主要问题在于ansible做的预处理的逻辑太多了, 而且主要框架严重依赖单独的ssd和shell, 这样带来的问题你就是部署的性能较差.</p>
<p>需要找一些优化的方案</p>
<ul>
<li>facts收集
<ul>
<li>关闭</li>
<li>设置缓存</li>
</ul></li>
<li>增加并发</li>
<li>修改运行策略为free等.</li>
<li>ssd长连接</li>
<li>开启pipelining.
<ul>
<li>原本的逻辑是将library,role等生成一个脚本, 复制到远程主机上, 再执行. 现在改为通过pipe直接传递给ssh会话.</li>
</ul></li>
<li>开启accelerate模式, 是需要对面的远程服务, 预计是通过rpc类似?</li>
<li>通过poll设置一段时间后再来查询, 不阻塞着等待了.</li>
</ul>
<h2 id="插件开发">插件开发</h2>
<h3 id="callback">callback</h3>
<p>主要目的是支持可以解析出当前失败的任务, 然后给另一个进行重试的接口进行使用.</p>
<h2 id="rolling-upgrade什么意思">rolling upgrade什么意思</h2>
<p>好像应该叫做rolling update模型, 哦,滚动升级</p>
<p>哦, 忽然明白为什么是loop结合delegate_to了, 因为要的不是并发,而是滚动操作.</p>
<h4 id="继承的方法">继承的方法</h4>
<ul>
<li>v2_runner_on_failed</li>
<li>runner_on_failed</li>
</ul>
<p>这俩函数有什么区别呢? 目前看起来v2版本并没有加强多少? 那就随意使用了先.</p>
<h2 id="理解开发方式">理解开发方式</h2>
<p>感觉[^3]这种插件的阅读方式能提供一些参考.</p>
<h3 id="python调用ansible">python调用ansible</h3>
<p><a href="http://blog.65535.fun/article/2020/7/9/100.html" target="_blank" rel="noopener">python3.8 调用ansible 2.9.4 api | 经验分享&amp;服务器代维</a></p>
<h1 id="ansible使用">ansible使用</h1>
<h2 id="调试方式">调试方式</h2>
<ul>
<li>epdb</li>
<li>-vvvvvv
<ul>
<li>虽然文档中只写了<code>-vvv</code>, 但是实际上代码里有一部分写了<code>vvvvvv</code>的函数.</li>
</ul></li>
<li>设置ANSIBLE_KEEP_REMOTTE_FILES=1, 然后再运行Ansbile命令
<ul>
<li>ansible运行前生成的临时脚本就会保存下来, 不会被删除了.</li>
</ul></li>
</ul>
<h2 id="tower付费部分">tower付费部分</h2>
<ul>
<li>workflow?
<ul>
<li>workflow和任务队列的区别应该在于低代码吧?</li>
<li>还是说图形界面的任务的图形化操纵叫做workflow?</li>
</ul></li>
</ul>
<h2 id="练习方式">练习方式</h2>
<p><a href="https://github.com/chusiang/ansible-jupyter.dockerfile" target="_blank" rel="noopener">chusiang/ansible-jupyter.dockerfile: Building the Docker image with Ansible and Jupyter.</a></p>
<p><a href="https://www.w3cschool.cn/automate_with_ansible/automate_with_ansible-7wir27p7.html" target="_blank" rel="noopener">Ansible 用 Docker Compose 练习 Ansible_w3cschool</a></p>
<h2 id="执行">执行</h2>
<p>通过<code>playbook</code>调度<code>role</code>的<code>task</code>, 来进行批量任务执行. ### workflow操作多个playbook是否有开源替代方案? 还是直接写playbook, 通过role控制. 目前来看, 不算特别关键.</p>
<h2 id="语法">语法</h2>
<h3 id="playbook">playbook</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ansible-playbook -i &#123;inventory host&#125; add-osd.yml</span><br><span class="line"></span><br><span class="line"><span class="comment"># check</span></span><br><span class="line">ansible-playbook foo.yml --check</span><br></pre></td></tr></table></figure>
<h3 id="delegate_to">delegate_to</h3>
<p>这里为什么看到和<code>loop</code>一起使用? <code>delegate_to</code>不支持直接指定组嘛?为什么要<code>loop</code></p>
<p>这个的主要用途难道不是到一个只需要一个组内的一个节点执行的时候, 直接选中某一个吗?</p>
<p>ansible解析参数的过程, 和delegate_to这种指定某个节点只执行一次的逻辑, 是哪个优先呢?</p>
<p>如果是后者, 那是否这个的目的是用来让这个组内只在第一个节点执行一次?</p>
<p>但是感觉有点像是后者</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">delegate_to:</span> <span class="string">"<span class="template-variable">&#123;&#123; item &#125;&#125;</span>"</span></span><br><span class="line"><span class="attr">loop:</span> <span class="string">"<span class="template-variable">&#123;&#123; xxx &#125;&#125;</span>"</span></span><br></pre></td></tr></table></figure>
<h3 id="role">role</h3>
<p>自定义模块, 内部包含具体的<code>task</code></p>
<h4 id="依赖管理">依赖管理</h4>
<blockquote>
<p>在 playbook 中存在多个 roles，且其中有相互依赖关系时，合理使用 meta 配置，填写其所依赖的 roles。注意，被依赖的 roles 会优先执行</p>
</blockquote>
<h3 id="ad-hoc">ad-hoc</h3>
<p>全节点临时执行的命令, 这个对于排查问题全节点查日志的时候还是用的比较多的.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible 主机或组 -m <span class="built_in">command</span>  -a <span class="string">'模块参数'</span>  ansible参数</span><br></pre></td></tr></table></figure>
<h1 id="ceph-ansile">ceph-ansile</h1>
<p>[^2]里稍微解释了一部分.</p>
<h2 id="问题">问题</h2>
<p>根据目前的调研结果来看, 存在两个问题 * osd层无法支持用于db,wal分区之后剩余空间创建osd * crush rule无法自由指定 * 不支持tier创建 * 不支持针对ec模式下的资源池,通过创建副本的元数据资源池进行创建rbd.</p>
<h3 id="二次开发问题">二次开发问题</h3>
<ul>
<li>开发环境到底怎么才能部署起来呢?如果不使用实机已经装好ceph和ceph-ansible的环境, 就没有办法了?</li>
<li>为什么看vagrant.yml.sample里, 都是从一个裸机开始呢?怎么里面就不能装好ceph依赖吗?</li>
</ul>
<p>姑且按照[^5]先启动看看.`</p>
<p><a href="https://hub.docker.com/r/osism/ceph-ansible/tags" target="_blank" rel="noopener">osism/ceph-ansible Tags - Docker Hub</a></p>
<p>vagrant 启动失败了, 似乎我用的centos景象不太一样, 找个docker hub里的试试</p>
<p><a href="https://docs.osism.de/configuration/environments/ceph.html" target="_blank" rel="noopener">Ceph — OSISM documentation</a></p>
<p>所以library其实完成的任务就是拼接command?</p>
<p><a href="https://www.jianshu.com/p/ec1e4d8438e9" target="_blank" rel="noopener">AnsibleAPI 开发 - 简书</a> 参考上面这篇文章基本可以说明怎么使用ansible提供的库</p>
<h2 id="实践中的一些疑问">实践中的一些疑问</h2>
<h3 id="command和-debug冲突">command和 debug冲突?</h3>
<p>对应的是不同的Task, 因此的确会冲突</p>
<h3 id="shell和command有没有区别">shell和command有没有区别?</h3>
<p>一个是启动<code>shell</code>, 一个是启动<code>sh</code> 默认ansible使用的module 是 command，这个模块并不支持 shell 变量和管道等，若想使用shell 来执行模块，请使用-m 参数指定 shell 模块,但是值得注意的是普通的命令执行模块是通过python的ssh执行。</p>
<h3 id="changed-是用来标记task的幂等性满足与否">changed 是用来标记task的幂等性满足与否?</h3>
<p>的确, 用来标记这个任务是否对环境产生了修改?</p>
<h3 id="groups保留字">groups保留字</h3>
<p>属于ansible自身的保留字段</p>
<h3 id="变量和inventory还是有点区别的-虽然是这个主机组的-但是单纯的变量其实没有主机组的概念的.">变量和inventory还是有点区别的, 虽然是这个主机组的, 但是单纯的变量其实没有主机组的概念的.</h3>
<h3 id="为什么ceph没有提供给ansible基于rados的接口呢">为什么ceph没有提供给ansible基于rados的接口呢?</h3>
<p>是否是因为使用的是ssh等协议, 所以用Rados其实并不太方便? 并没有设计这个connection?如果要开发, 其实是开发一个connection机制吧?</p>
<p>主要用途是部署, 而在部署阶段, rados得在mon部署完毕后才能工作, 因此如果要切换connection, 还必须分阶段. 还不如直接ssh全套</p>
<h3 id="you-cannot-register-a-variable-but-you-can-set-a-fact-which-in-most-use-cases-including-yours-will-be-equivalent-to-a-variable">You cannot register a variable, but you can set a fact (which in most use cases, including yours, will be equivalent to a variable):</h3>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">- set_fact:</span></span><br><span class="line"><span class="attr">  the_output:</span> <span class="string">"<span class="template-variable">&#123;&#123; restdata.json.parameter[1] &#125;&#125;</span>"</span></span><br></pre></td></tr></table></figure>
<h3 id="要使用json_query-需要安装jmespath">要使用json_query , 需要安装jmespath</h3>
<h3 id="ansible使用register就会被标记成changed">ansible使用register就会被标记成changed?</h3>
<h3 id="为什么我用filter-带上2个大括号就无法识别出对象了呢">为什么我用filter, 带上2个大括号就无法识别出对象了呢?</h3>
<p>因为filter是jinja2语法, 外面需要先带上双引号. * You are using the debug: module with the option var: and this expects a variable, not a jinja2 template.</p>
<h3 id="对于您的模块支持检查模式您必须在实例化ansiblemodule对象时传递supports_check_mode-true-当启用检查模式时ansiblemodule.check_mode属性将计算为true">对于您的模块支持检查模式，您必须在实例化AnsibleModule对象时传递supports_check_mode = True。 当启用检查模式时，AnsibleModule.check_mode属性将计算为True。</h3>
<p>对task进行检查模式 ### ansible的模块里打印大量内容, 即便他不显示,也会记录到warning里? 有垃圾产生?</p>
<h3 id="ansible的library不允许使用print-居然就会报错.-没有日志-需要之后再找怎么记录日志的方式">ansible的library不允许使用print, 居然就会报错. 没有日志, 需要之后再找怎么记录日志的方式</h3>
<p>通过logging直接往其他文件, 或者通过Syslog协议等输出是一种方案.</p>
<p>或者可以记录到stderr中, ansible只检查stdout是否被污染, 然后报错.</p>
<h3 id="out不能是变量-只能是字符串">out不能是变量? 只能是字符串?</h3>
<p>这个还需要找一下</p>
<h3 id="通过debug可以打印出ansible_facts-但是直接引用就一直打印不出来-忽然脑子过了一下-想通了-ansible_facts应该是上层概念-对于使用的应该直接填key就可以了-然后的确拿出来了.">通过debug可以打印出Ansible_facts, 但是直接引用就一直打印不出来, 忽然脑子过了一下, 想通了, ansible_facts应该是上层概念, 对于使用的应该直接填key就可以了, 然后的确拿出来了.</h3>
<h3 id="字符串输出转换-坑">字符串输出转换, 坑</h3>
<ul>
<li><code>{}</code> 会把字符串转换成object, 导致即便to_json了, 双引号也没了, 其他程序无法识别了.</li>
<li>jinja2的语法问题</li>
<li><a href="https://github.com/ansible/ansible/issues/44897" target="_blank" rel="noopener">Double quotes are converted to single quotes on variable assignment if contents look like JSON · Issue #44897 · ansible/ansible</a></li>
<li><a href="https://stackoverflow.com/questions/41144922/ansible-passing-json-string-in-environment-to-shell-module" target="_blank" rel="noopener">Ansible - passing JSON string in environment to shell module - Stack Overflow</a></li>
</ul>
<h3 id="ansiblesequence是什么东西">ansibleSequence是什么东西?</h3>
<h3 id="字典的key索引不会被jinja2解析-这个真的是深坑">字典的key索引不会被Jinja2解析, 这个真的是深坑</h3>
<ul>
<li>感觉看了下, 这个坑很大啊…一点都不方便debug</li>
</ul>
<p><img src="/2021/02/18/ceph之ansible理解/ceph之ansible理解_2020-11-12-00-49-50.png"></p>
<h3 id="莫名其妙的module-failure">莫名其妙的module failure</h3>
<p>没有提示的时候, 实际上问题就是在于你的模块里用了print…</p>
<p>ansible 是只检测stdout是否被污染, 所以如果我把信息写到Stderr里是没问题的.</p>
<h3 id="python3支持问题">python3支持问题</h3>
<p>我们目前用的<code>ansible 2.6</code>, 我指望使用python3来进行操作, 避免一些问题.</p>
<p>按照[^13]里提到的来说, 理论上会按照从哪个python版本安装的<code>ansible</code>, 就从哪个版本启动的功能.</p>
<p>根据[^11]发现的问题就是, 我用的<code>2.6</code>通过<code>ansible.cfg</code>中的设置, 并没能生效, 而通过<code>-e</code>传入的参数倒是有效. 暂时通过上层传入来覆盖下层使用的解释器</p>
<h3 id="group_vars的读取时间是什么时候嗯">group_vars的读取时间是什么时候嗯</h3>
<p>只会在执行role的时候去读取对应的<code>group_vars</code>中的变量</p>
<h3 id="怎么将当前读入的配置及收集到的facts配置导出呢">怎么将当前读入的配置及收集到的<code>facts</code>配置导出呢</h3>
<ul>
<li>怎么执行Export呢?</li>
<li><blockquote>
<p>template - Templates a file out to a remote server</p>
</blockquote></li>
<li><a href="https://github.com/ansible/ansible/issues/34595#issuecomment-356091161" target="_blank" rel="noopener">copy content output from json and a variable is not idempotent under py3 · Issue #34595 · ansible/ansible</a></li>
</ul>
<h3 id="另外-其实我并不需要ansible原生的gather_facts-因为他能够给出来的ip-现在我知道一些python的原生库获取-重点在于-我怎么把多个节点的数据给聚合到一个节点上.">另外, 其实我并不需要ansible原生的gather_facts, 因为他能够给出来的ip, 现在我知道一些python的原生库获取, 重点在于, 我怎么把多个节点的数据给聚合到一个节点上.</h3>
<ul>
<li>通过set_fact去一起设置到一个字典里?</li>
<li>我通过vars聚合完了. 有个map(’extract’功能可以满足这套 <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">- hosts:</span> <span class="string">all</span></span><br><span class="line"><span class="attr">  vars:</span></span><br><span class="line"><span class="attr">    uuids:</span> <span class="string">|</span></span><br><span class="line"><span class="string">      &#123;%- set o=[] %&#125;</span></span><br><span class="line"><span class="string">      &#123;%- for i in play_hosts %&#125;</span></span><br><span class="line"><span class="string">        &#123;%- if o.append(hostvars[i].uuid) %&#125;</span></span><br><span class="line"><span class="string">        &#123;%- endif %&#125;</span></span><br><span class="line"><span class="string">      &#123;%- endfor %&#125;</span></span><br><span class="line"><span class="string">      <span class="template-variable">&#123;&#123; o &#125;&#125;</span></span></span><br><span class="line"><span class="string"></span><span class="attr">  tasks:</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">get</span> <span class="string">uuids</span> <span class="string">for</span> <span class="string">existing</span> <span class="string">cluster</span> <span class="string">nodes</span></span><br><span class="line"><span class="attr">      shell:</span> <span class="string">mysql</span> <span class="bullet">-N</span> <span class="bullet">-B</span> <span class="bullet">-u</span> <span class="string">&#123;&#123;</span> <span class="string">db_user</span> <span class="string">&#125;&#125;</span> <span class="bullet">-p</span> <span class="string">&#123;&#123;</span> <span class="string">db_user_password</span> <span class="string">&#125;&#125;</span> <span class="bullet">-e</span> <span class="string">"SHOW GLOBAL STATUS LIKE 'wsrep_cluster_state_uuid';"</span> <span class="string">| sed 's/\t/,/g' | cut -f2 -d','</span></span><br><span class="line"><span class="string"></span><span class="attr">      register:</span> <span class="string">maria_cluster_uuids</span></span><br><span class="line"><span class="attr">    - set_fact:</span></span><br><span class="line"><span class="attr">        uuid:</span> <span class="string">"<span class="template-variable">&#123;&#123; maria_cluster_uuids.stdout &#125;&#125;</span>"</span></span><br><span class="line"><span class="attr">    - debug:</span></span><br><span class="line"><span class="attr">        var:</span> <span class="string">uuids</span></span><br><span class="line"><span class="attr">      run_once:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">      delegate_to:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p><a href="https://serverfault.com/questions/710010/is-it-possible-combine-remote-results-to-local-a-register-in-ansible/714455" target="_blank" rel="noopener">Is it possible combine remote results to local a register in Ansible? - Server Fault</a></p>
<h3 id="vars选项的运行时间是什么时候呢-如果我采用task-他能在我指定task前自动运行吗">vars选项的运行时间是什么时候呢? 如果我采用task, 他能在我指定task前自动运行吗?</h3>
<ul>
<li>vars的调用时间是什么时候呢? 写个代码模拟一下?</li>
<li>目前来看, 是当用到这个变量的时候, 才会去计算</li>
<li>有没有办法把list的tuple转成dict呢?</li>
</ul>
<h1 id="reference">Reference</h1>
<ol type="1">
<li><a href="https://zhoubofsy.github.io/2019/09/28/storage/ceph/ceph-ansible-usage/" target="_blank" rel="noopener">ceph-ansible 使用 | Bolog</a></li>
<li><a href="https://blog.csdn.net/O4dC8OjO7ZL6/article/details/78464441" target="_blank" rel="noopener">干货｜基于Ansible的Ceph自动化部署解析_中兴开发者社区-CSDN博客</a></li>
<li><a href="https://segmentfault.com/a/1190000015953427" target="_blank" rel="noopener">第八章: 扩展ansible_个人文章 - SegmentFault 思否</a></li>
<li><a href="https://github.com/ceph/ceph-ansible/issues/2195" target="_blank" rel="noopener">Full support for  · Issue #2195 · ceph/ceph-ansible</a></li>
<li><a href="https://www.sebastien-han.fr/blog/2016/02/08/easily-deploy-containerized-ceph-daemons-with-vagrant/" target="_blank" rel="noopener">Easily deploy containerized Ceph daemons with Vagrant | Sébastien Han</a></li>
<li><a href="https://blog.51cto.com/hy2009/1843232" target="_blank" rel="noopener">ansible debug模块学习笔记-行者之路-51CTO博客</a></li>
<li><a href="https://www.cnblogs.com/biglittleant/p/13072981.html" target="_blank" rel="noopener">一文搞懂 ansible 变量配置 - biglittleant - 博客园</a></li>
<li><a href="https://developer.ibm.com/zh/depmodels/cloud/articles/cl-lo-ansible-large-scale-use-of-enterprises-explore/" target="_blank" rel="noopener">Ansible 面向企业大规模使用探究 – IBM Developer</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/147242775" target="_blank" rel="noopener">可能是最强网工ansible入门及深入教程之 ansible杂谈 - 知乎</a></li>
<li><a href="https://zdyxry.github.io/2018/11/24/Ansible%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/" target="_blank" rel="noopener">Ansible最佳实践 | Yiran’s Blog</a></li>
<li><a href="https://github.com/ansible/ansible/blob/stable-2.6/docs/docsite/rst/reference_appendices/python_3_support.rst" target="_blank" rel="noopener">ansible/python_3_support.rst at stable-2.6 · ansible/ansible</a></li>
<li><a href="https://docs.ansible.com/ansible/latest/reference_appendices/interpreter_discovery.html" target="_blank" rel="noopener">Interpreter Discovery — Ansible Documentation</a></li>
<li><a href="https://github.com/ansible/ansible/issues/69494" target="_blank" rel="noopener">Wrong python2 interpreter instead of python3 · Issue #69494 · ansible/ansible</a></li>
<li><a href="https://blog.didispace.com/devops-for-small-team/" target="_blank" rel="noopener">一些小团队的自动化运维实践经验 | 程序猿DD</a></li>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-manage-multistage-environments-with-ansible" target="_blank" rel="noopener">How to Manage Multistage Environments with Ansible | DigitalOcean</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/291348171" target="_blank" rel="noopener">基于Ansible自研的可视化和并行自动化运维引擎 - 知乎</a></li>
<li><a href="https://www.gaott.top/dive-into-ansible-source-code/" target="_blank" rel="noopener">Ansible 实现原理（源码分析） – Tiantian Gao ( gtt116 )</a></li>
</ol>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2021-02-18T11:15:29.900Z" itemprop="dateUpdated">2021-02-18 19:15:29</time>
</span><br>


        
        欢迎评论~
        
    </div>
    
    <footer>
        <a href="https://sean10.github.io">
            <img src="/img/avatar.jpg" alt="Sean10">
            Sean10
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ansible/">ansible</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ceph/">ceph</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/">linux</a></li></ul>


            
<!-- Go to www.addthis.com/dashboard to customize your tools --> 
<div class="addthis_sharing_toolbox"></div>
            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://sean10.github.io/2021/02/18/ceph之ansible理解/&title=《ceph之ansible理解》 — 行路中.&pic=https://sean10.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://sean10.github.io/2021/02/18/ceph之ansible理解/&title=《ceph之ansible理解》 — 行路中.&source=笔记 随笔" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://sean10.github.io/2021/02/18/ceph之ansible理解/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《ceph之ansible理解》 — 行路中.&url=https://sean10.github.io/2021/02/18/ceph之ansible理解/&via=https://sean10.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://sean10.github.io/2021/02/18/ceph之ansible理解/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between flex-row-reverse">
  

  
    <div class="waves-block waves-effect next">
      <a href="/2021/01/31/文本编辑文章的感触/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">[no title]</h4>
      </a>
    </div>
  
</nav>



    











    <!-- Valine Comments -->
    <div class="comments vcomment" id="comments"></div>
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script>
    <!-- Valine Comments script -->
    <script>
        var GUEST_INFO = ['nick','mail','link'];
        var guest_info = 'nick,mail,link'.split(',').filter(function(item){
          return GUEST_INFO.indexOf(item) > -1
        });
        new Valine({
            el: '#comments',
            notify: 'true' == 'true',
            verify: 'false' == 'true',
            appId: "yNexbxJmshSneppnaoo3Bd6Y-gzGzoHsz",
            appKey: "FyxT8MxDPHbu8mQSapgjEMPC",
            avatar: "mm",
            placeholder: "Just go go",
            guest_info: guest_info.length == 0 ? GUEST_INFO : guest_info,
            pageSize: "10"
        })
    </script>
    <!-- Valine Comments end -->







</article>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>




        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>Sean10 &copy; 2015 - 2021</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://sean10.github.io/2021/02/18/ceph之ansible理解/&title=《ceph之ansible理解》 — 行路中.&pic=https://sean10.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://sean10.github.io/2021/02/18/ceph之ansible理解/&title=《ceph之ansible理解》 — 行路中.&source=笔记 随笔" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://sean10.github.io/2021/02/18/ceph之ansible理解/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《ceph之ansible理解》 — 行路中.&url=https://sean10.github.io/2021/02/18/ceph之ansible理解/&via=https://sean10.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://sean10.github.io/2021/02/18/ceph之ansible理解/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="//api.qrserver.com/v1/create-qr-code/?data=https://sean10.github.io/2021/02/18/ceph之ansible理解/" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<!-- Go to www.addthis.com/dashboard to customize your tools --> 
<script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-57108c0b91bea817"></script>

<script src="/js/main.min.js?v=1.7.2"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.min.js?v=1.7.2" async></script>



<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" async></script>




<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->





</body>
</html>
